<<<<<<< HEAD
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.mappers.board">
	<select id="select" parameterType="map" resultType="map">
		SELECT *
		  FROM PRODUCT
		 WHERE PRO_NO = #{proNo}
	</select>
	<insert id="insertBoard" parameterType="String" statementType="CALLABLE">
		{CALL PROC_INSERT_BOARD(
	        #{jsonParams, jdbcType=VARCHAR}
		)}
	</insert>
	<insert id="insertPreBoard" parameterType="map">
	    INSERT INTO PRODUCT_PRE(PRE_MEMID, PRE_BONO, PRE_TC, PRE_CATE, PRE_NAME, PRE_PRICE, PRE_CONTENT, PRE_DATE)
	    VALUES (
	        #{preMemid},
	        (SELECT IFNULL(MAX(CAST(PRE_BONO AS UNSIGNED)), 0) + 1 FROM (SELECT * FROM PRODUCT_PRE) AS TEMP),
	        #{preTc},
	        #{preCate},
	        #{preName},
	        #{prePrice},
	        #{preContent},
	        DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
	    )
	</insert>
	<insert id="insertPreAuction" parameterType="map">
		INSERT INTO AUCTION_PRE(PRA_MEMID,PRA_CATE,PRA_BONO,PRA_NAME,PRA_CONTENT,PRA_SP,PRA_INP,PRA_BP,PRA_TC,PRA_DATE)
		VALUES(
			#{praMemid},
			#{praCate},
			(SELECT IFNULL(MAX(CAST(PRA_BONO AS UNSIGNED)), 0) + 1 FROM (SELECT * FROM AUCTION_PRE) AS TEMP),
			#{praName},
			#{praContent},
			#{praSp},
			#{praInp},
			#{praBp},
			#{praTc},
			DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
		)
	</insert>
	
	<select id="selectBoard" resultType="map" parameterType="map">
		SELECT PRO_WR,PRO_NAME,PRO_PRICE,PRO_DATE,IMG_NAME
			  ,CODE_TC.CODE AS PRO_TC_CODE, CODE_TSC.CODE AS PRO_TSC_CODE
		  FROM PRODUCT
		  JOIN IMAGE ON PRO_NO = IMG_PRONO
		  JOIN CODE AS CODE_TC ON PRO_TC = CONCAT(CODE_TC.CO_TYPE, CODE_TC.CO_NO)
		  JOIN CODE AS CODE_TSC ON PRO_TSC = CONCAT(CODE_TSC.CO_TYPE, CODE_TSC.CO_NO)
	    <if test="proTc != null">
	       AND PRO_TC = #{proTc}
	    </if>
	     WHERE IMG_NO = 1
		 ORDER BY PRO_DATE DESC
	</select>
	
	
	<!-- 성엽 작업 시작 -->
	
	<select id="selectBuyBoard" resultType="map">
		SELECT *
		  FROM PRODUCT
		  JOIN IMAGE
			ON PRO_NO = IMG_PRONO
		  JOIN CODE
			ON PRO_TC = CONCAT(CO_TYPE, CO_NO)
		 WHERE IMG_NO = 1
		   AND PRO_TC = CONCAT(CO_TYPE, '2')
		 ORDER BY PRO_DATE DESC 
	</select>
	
	<!-- 성엽 작업 끝 -->
	
	
	<select id="selectBoardDetail" parameterType="map" resultType="map">
		SELECT PRO_NO,PRO_TC,PRO_WR,PRO_DATE,PRO_PRICE,PRO_HITS,PRO_CONTENT,PRO_NAME,PRO_STATUS,PRO_TSC,PRO_CATE,PRO_ADDRESS
			  ,ADD_NAME,ADD_NO,ADD_POST,ADD_DETAIL,ADD_NICK
			  ,IMG_NAMES
		      ,CODE_TC.CODE AS PRO_TC_CODE, CODE_TSC.CODE AS PRO_TSC_CODE
		      ,CODE_CATE.CODE AS PRO_CATE_CODE, CODE_STATUS.CODE AS PRO_STATUS_CODE
		  FROM PRODUCT p
		  JOIN (select IMG_PRONO, group_concat(IMG_NAME order by IMG_NO separator '|') IMG_NAMES from IMAGE group by IMG_PRONO) i
		    ON p.PRO_NO = i.IMG_PRONO
		  JOIN ADDRESS a ON p.PRO_ADDRESS = a.ADD_NO
		  JOIN CODE AS CODE_TC ON PRO_TC = CONCAT(CODE_TC.CO_TYPE, CODE_TC.CO_NO)
		  JOIN CODE AS CODE_TSC ON PRO_TSC = CONCAT(CODE_TSC.CO_TYPE, CODE_TSC.CO_NO)
		  JOIN CODE AS CODE_CATE ON PRO_CATE = CONCAT(CODE_CATE.CO_TYPE, CODE_CATE.CO_NO)
		  JOIN CODE AS CODE_STATUS ON PRO_STATUS = CONCAT(CODE_STATUS.CO_TYPE, CODE_STATUS.CO_NO)	
		 WHERE PRO_WR = #{proWr} AND PRO_DATE = #{proDate}
	</select>
	<update id="upHits" parameterType="map">
		UPDATE PRODUCT
		   SET PRO_HITS = PRO_HITS + 1
		 WHERE PRO_WR = #{proWr} AND PRO_DATE = #{proDate} 
	</update>
	<select id="getImgMap" resultType="map">
		SELECT *
		FROM IMAGE
		<where>
		  <if test="proNo != null">
		    IMG_PRONO = #{proNo}
		  </if>
		  <if test="aucNo != null">
		    IMG_PRONO = #{aucNo}
		  </if>
		</where>
	</select>
	<select id="deleteBoard" parameterType="map" statementType="CALLABLE">
		{CALL PROC_DELETE_BOARD(
	        #{proNo, mode=IN, jdbcType=VARCHAR},
	        #{aucNo, mode=IN, jdbcType=VARCHAR},
	        #{success, mode=OUT, jdbcType=VARCHAR}
		)}		
	</select>

	<select id="selectAddress" resultType="map">
		SELECT A.ADD_NO,A.ADD_POST,A.ADD_NAME,A.ADD_DETAIL,A.ADD_NICK,M.MEM_ID
		  FROM ADDRESS A
		  JOIN MEMBERS M
		    ON A.MEM_NO = M.MEM_NO
		 WHERE M.MEM_ID = #{id}  
	</select>
	<select id="getProNo" parameterType="map" resultType="String">
		SELECT PRO_NO
		  FROM PRODUCT
		 WHERE PRO_WR = #{proWr} AND PRO_DATE = #{proDate}
	</select>
	<select id="getAucNo" parameterType="map" resultType="String">
		SELECT AUC_NO
		  FROM AUCTION
		 WHERE AUC_SELLER = #{aucSeller} AND AUC_DATE = #{aucDate}
	</select>
	<delete id="deleteImgs" parameterType="map">
	    <choose>
	        <when test="aucNo != null">
	            DELETE FROM IMAGE
	            WHERE IMG_PRONO = #{aucNo}
	        </when>
	        <otherwise>
	            DELETE FROM IMAGE
	            WHERE IMG_PRONO = #{proNo}
	        </otherwise>
	    </choose>
	</delete>
	<insert id="insertImgs" parameterType="map">
	    <choose>
	        <when test="aucNo != null">
	            INSERT INTO IMAGE (IMG_CATE, IMG_PRONO, IMG_NO, IMG_NAME)
	            VALUES
	            <foreach collection="imagesWithNumbers" item="image" separator=",">
	                (#{aucCate}, #{aucNo}, #{image.imgNo}, #{image.filename})
	            </foreach>
	        </when>
	        <otherwise>
	            INSERT INTO IMAGE (IMG_CATE, IMG_PRONO, IMG_NO, IMG_NAME)
	            VALUES
	            <foreach collection="imagesWithNumbers" item="image" separator=",">
	                (#{proCate}, #{proNo}, #{image.imgNo}, #{image.filename})
	            </foreach>
	        </otherwise>
	    </choose>
	</insert>
	<update id="updateBoard" parameterType="map">
		UPDATE PRODUCT
		   SET PRO_CATE = #{proCate}
			  ,PRO_NAME = #{proName}
			  ,PRO_PRICE = #{proPrice}
			  ,PRO_CONTENT = #{proContent}
			  ,PRO_TC = #{proTc}
			  ,PRO_TSC = #{proTsc}
			  ,PRO_CDATE = date_format(NOW(),'%Y%m%d%H%i%s')
			  ,PRO_STATUS = #{proStatus}
			  ,PRO_ADDRESS = #{proAddress}
		WHERE PRO_NO = #{proNo}	
	</update>
	<select id="selectAuction" parameterType="map" resultType="map">
		SELECT AUC_NO,AUC_SELLER,AUC_NAME,AUC_BP,AUC_DATE,IMG_NAME
			  ,CODE_TC.CODE AS AUC_TC_CODE, CODE_TSC.CODE AS AUC_TSC_CODE
		  FROM AUCTION
		  JOIN IMAGE ON AUC_NO = IMG_PRONO
		  JOIN CODE AS CODE_TC ON AUC_TC = CONCAT(CODE_TC.CO_TYPE, CODE_TC.CO_NO)
		  JOIN CODE AS CODE_TSC ON AUC_TSC = CONCAT(CODE_TSC.CO_TYPE, CODE_TSC.CO_NO)
	       AND AUC_TC = #{aucTc}
	     WHERE IMG_NO = 1
		 ORDER BY AUC_DATE DESC				
	</select>
	<update id="aucHits" parameterType="map">
		UPDATE AUCTION
		   SET AUC_HITS = AUC_HITS + 1
		 WHERE AUC_SELLER = #{aucSeller} AND AUC_DATE = #{aucDate} 
	</update>
	<select id="selectAuctionDetail" parameterType="map" resultType="map">
		SELECT AUC_NO,AUC_TC,AUC_SELLER,AUC_DATE,AUC_BP,AUC_HITS,AUC_CONTENT,AUC_NAME,AUC_STATUS,AUC_TSC,AUC_CATE,AUC_ADDRESS,AUC_MINP,AUC_SP,AUC_ETIME,AUC_INP
			  ,ADD_NAME,ADD_NO,ADD_POST,ADD_DETAIL,ADD_NICK
			  ,IMG_NAMES
		      ,CODE_TC.CODE AS AUC_TC_CODE, CODE_TSC.CODE AS AUC_TSC_CODE
		      ,CODE_CATE.CODE AS AUC_CATE_CODE, CODE_STATUS.CODE AS AUC_STATUS_CODE
		  FROM AUCTION auc
		  JOIN (select IMG_PRONO, group_concat(IMG_NAME order by IMG_NO separator '|') IMG_NAMES from IMAGE group by IMG_PRONO) i
		    ON auc.AUC_NO = i.IMG_PRONO
		  JOIN ADDRESS a ON auc.AUC_ADDRESS = a.ADD_NO
		  JOIN CODE AS CODE_TC ON AUC_TC = CONCAT(CODE_TC.CO_TYPE, CODE_TC.CO_NO)
		  JOIN CODE AS CODE_TSC ON AUC_TSC = CONCAT(CODE_TSC.CO_TYPE, CODE_TSC.CO_NO)
		  JOIN CODE AS CODE_CATE ON AUC_CATE = CONCAT(CODE_CATE.CO_TYPE, CODE_CATE.CO_NO)
		  JOIN CODE AS CODE_STATUS ON AUC_STATUS = CONCAT(CODE_STATUS.CO_TYPE, CODE_STATUS.CO_NO)	
		 WHERE AUC_SELLER = #{aucSeller} AND AUC_DATE = #{aucDate}
	</select>
	<update id="updateAuction" parameterType="map">
		UPDATE AUCTION
		   SET AUC_CATE = #{aucCate}
		      ,AUC_NAME = #{aucName}
		      ,AUC_CONTENT = #{aucContent}
			  ,AUC_SP = #{aucSp}
			  ,AUC_INP = #{aucInp}
			  ,AUC_TC = #{aucTc}
			  ,AUC_CDATE = date_format(NOW(),'%Y%m%d%H%i%s')
			  ,AUC_MINP = #{aucMinp}
			  ,AUC_TSC = #{aucTsc}
			  ,AUC_STATUS = #{aucStatus}
		 WHERE AUC_NO = #{aucNo}
	</update>
	
=======
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.mappers.board">
	<select id="select" parameterType="map" resultType="map">
		SELECT *
		  FROM PRODUCT
		 WHERE PRO_NO = #{proNo}
	</select>
	<insert id="insertBoard" parameterType="String" statementType="CALLABLE">
		{CALL PROC_INSERT_BOARD(
	        #{jsonParams, jdbcType=VARCHAR}
		)}
	</insert>
	<insert id="insertPreBoard" parameterType="map">
	    INSERT INTO PRODUCT_PRE(PRE_MEMID, PRE_BONO, PRE_TC, PRE_CATE, PRE_NAME, PRE_PRICE, PRE_CONTENT, PRE_DATE)
	    VALUES (
	        #{preMemid},
	        (SELECT IFNULL(MAX(CAST(PRE_BONO AS UNSIGNED)), 0) + 1 FROM (SELECT * FROM PRODUCT_PRE) AS TEMP),
	        #{preTc},
	        #{preCate},
	        #{preName},
	        #{prePrice},
	        #{preContent},
	        DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
	    )
	</insert>
	<insert id="insertPreAuction" parameterType="map">
		INSERT INTO AUCTION_PRE(PRA_MEMID,PRA_CATE,PRA_BONO,PRA_NAME,PRA_CONTENT,PRA_SP,PRA_INP,PRA_BP,PRA_TC,PRA_DATE)
		VALUES(
			#{praMemid},
			#{praCate},
			(SELECT IFNULL(MAX(CAST(PRA_BONO AS UNSIGNED)), 0) + 1 FROM (SELECT * FROM AUCTION_PRE) AS TEMP),
			#{praName},
			#{praContent},
			#{praSp},
			#{praInp},
			#{praBp},
			#{praTc},
			DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
		)
	</insert>
	
	<select id="selectBoard" resultType="map" parameterType="map">
		SELECT PRO_WR,PRO_NAME,PRO_PRICE,PRO_DATE,IMG_NAME
			  ,CODE_TC.CODE AS PRO_TC_CODE, CODE_TSC.CODE AS PRO_TSC_CODE
		  FROM PRODUCT
		  JOIN IMAGE ON PRO_NO = IMG_PRONO
		  JOIN CODE AS CODE_TC ON PRO_TC = CONCAT(CODE_TC.CO_TYPE, CODE_TC.CO_NO)
		  JOIN CODE AS CODE_TSC ON PRO_TSC = CONCAT(CODE_TSC.CO_TYPE, CODE_TSC.CO_NO)
	    <if test="proTc != null">
	       AND PRO_TC = #{proTc}
	    </if>
	     WHERE IMG_NO = 1
		 ORDER BY PRO_DATE DESC
	</select>
	
	
	<!-- 성엽 작업 시작 -->
	
	<select id="selectBuyBoard" resultType="map">
		SELECT *
		  FROM PRODUCT
		  JOIN IMAGE
			ON PRO_NO = IMG_PRONO
		  JOIN CODE
			ON PRO_TC = CONCAT(CO_TYPE, CO_NO)
		 WHERE IMG_NO = 1
		   AND PRO_TC = CONCAT(CO_TYPE, '2')
		 ORDER BY PRO_DATE DESC 
	</select>
	
	<!-- 성엽 작업 끝 -->
	
	
	<select id="selectBoardDetail" parameterType="map" resultType="map">
		SELECT PRO_NO,PRO_TC,PRO_WR,PRO_DATE,PRO_PRICE,PRO_HITS,PRO_CONTENT,PRO_NAME,PRO_STATUS,PRO_TSC,PRO_CATE,PRO_ADDRESS
			  ,ADD_NAME,ADD_NO,ADD_POST,ADD_DETAIL,ADD_NICK
			  ,IMG_NAMES
		      ,CODE_TC.CODE AS PRO_TC_CODE, CODE_TSC.CODE AS PRO_TSC_CODE
		      ,CODE_CATE.CODE AS PRO_CATE_CODE, CODE_STATUS.CODE AS PRO_STATUS_CODE
		  FROM PRODUCT p
		  JOIN (select IMG_PRONO, group_concat(IMG_NAME order by IMG_NO separator '|') IMG_NAMES from IMAGE group by IMG_PRONO) i
		    ON p.PRO_NO = i.IMG_PRONO
		  JOIN ADDRESS a ON p.PRO_ADDRESS = a.ADD_NO
		  JOIN CODE AS CODE_TC ON PRO_TC = CONCAT(CODE_TC.CO_TYPE, CODE_TC.CO_NO)
		  JOIN CODE AS CODE_TSC ON PRO_TSC = CONCAT(CODE_TSC.CO_TYPE, CODE_TSC.CO_NO)
		  JOIN CODE AS CODE_CATE ON PRO_CATE = CONCAT(CODE_CATE.CO_TYPE, CODE_CATE.CO_NO)
		  JOIN CODE AS CODE_STATUS ON PRO_STATUS = CONCAT(CODE_STATUS.CO_TYPE, CODE_STATUS.CO_NO)	
		 WHERE PRO_WR = #{proWr} AND PRO_DATE = #{proDate}
	</select>
	<update id="upHits" parameterType="map">
		UPDATE PRODUCT
		   SET PRO_HITS = PRO_HITS + 1
		 WHERE PRO_WR = #{proWr} AND PRO_DATE = #{proDate} 
	</update>
	<select id="getImgMap" resultType="map">
		SELECT *
		  FROM IMAGE
		 WHERE IMG_PRONO = #{proNo};
	</select>
	<select id="deleteBoard" parameterType="map" statementType="CALLABLE">
		{CALL PROC_DELETE_BOARD(
	        #{proNo, mode=IN, jdbcType=VARCHAR},
	        #{success, mode=OUT, jdbcType=VARCHAR}
		)}		
	</select>
	<select id="selectAddress" resultType="map">
		SELECT A.ADD_NO,A.ADD_POST,A.ADD_NAME,A.ADD_DETAIL,A.ADD_NICK,M.MEM_ID
		  FROM ADDRESS A
		  JOIN MEMBERS M
		    ON A.MEM_NO = M.MEM_NO
		 WHERE M.MEM_ID = #{id}  
	</select>
	<select id="getProNo" parameterType="map" resultType="String">
		SELECT PRO_NO
		  FROM PRODUCT
		 WHERE PRO_WR = #{proWr} AND PRO_DATE = #{proDate}
	</select>
	<delete id="deleteImgs" parameterType="map">
		DELETE FROM IMAGE
		WHERE IMG_PRONO = #{proNo}
	</delete>
	<insert id="insertImgs" parameterType="map">
	    INSERT INTO IMAGE (IMG_CATE, IMG_PRONO, IMG_NO, IMG_NAME)
	    VALUES
	    <foreach collection="imagesWithNumbers" item="image" separator=",">
	        (#{proCate}, #{proNo}, #{image.imgNo}, #{image.filename})
	    </foreach>
	</insert>
	<update id="updateBoard" parameterType="map">
		UPDATE PRODUCT
		   SET PRO_CATE = #{proCate}
			  ,PRO_NAME = #{proName}
			  ,PRO_PRICE = #{proPrice}
			  ,PRO_CONTENT = #{proContent}
			  ,PRO_TC = #{proTc}
			  ,PRO_TSC = #{proTsc}
			  ,PRO_CDATE = date_format(NOW(),'%Y%m%d%H%i%s')
			  ,PRO_STATUS = #{proStatus}
			  ,PRO_ADDRESS = #{proAddress}
		WHERE PRO_NO = #{proNo}	
	</update>

>>>>>>> branch 'song' of https://github.com/hhyeonaa/c2d2309t1_2.git
</mapper>