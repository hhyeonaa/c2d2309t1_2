<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.mappers.adminMapper">
	
<!-- 	===== 현아 시작 ===== -->

	<insert id="adminInsert">
		insert into ADMIN
			(AD_NO
			, AD_ID 
			, AD_PW
			, AD_NAME
			, AD_DATE
			, AD_ACTIVE
			, ROL_NO)
		values (CONCAT("AD", IFNULL((SELECT MAX(CAST(replace(AD_NO, "AD", "") AS unsigned))+1
									 FROM ADMIN A), 1))
			, #{AD_ID}
			, #{AD_PW}
			, #{AD_NAME}
			, DATE_FORMAT(SYSDATE(), '%Y%m%d%H%i%s')
			, '1'
			, 'RO3')
	</insert>
	
	<select id="getAdminList" resultType="map">
		select
			CAST(REPLACE(a.AD_NO, "AD", "") AS UNSIGNED) "AD_NO"
			, a.AD_ID
			, a.ROL_NO
<!-- 			, r.ROL_NAME   이부분 필요 없어져서 join 안써도 될듯?           -->  
			, a.AD_ACTIVE
		from ADMIN a join ROLE r
		on a.ROL_NO = r.ROL_NO
		ORDER BY AD_NO
	</select>
	
	<select id="idCheck" resultType="String">
		select
			AD_ID 
		from ADMIN
		where AD_ID = #{AD_ID}
	</select>
	
	<delete id="adminDelete">
		delete from ADMIN
		where AD_ID = #{AD_ID}
	</delete>
	
	<update id="adminUpdate">
		update ADMIN
		set AD_ACTIVE = #{AD_ACTIVE}
		where AD_NO = #{AD_NO}
	</update>
	
<!-- 	<select id="getBoardList" resultType="map"> -->
<!-- 		select CODE -->
<!-- 				, ACTIVE -->
<!-- 				, SEQ -->
<!-- 				, CASE CO_DETAIL WHEN '0' THEN '글' -->
<!-- 						   WHEN '1' THEN '글+사진' -->
<!-- 						   WHEN '2' THEN '글+사진+날짜' -->
<!-- 						   ELSE '없음' -->
<!-- 			   END AS "CO_DETAIL" -->
<!-- 		from CODE -->
<!-- 			where  CO_TYPE = 'MM' -->
<!-- 		ORDER BY SEQ -->
<!-- 	</select> -->
	
	<update id="displayUpdate">
		<foreach collection="list" item="code" open="" close="" separator=";">
		update CODE
		   set CODE = #{code.CODE}
		   	 , ACTIVE = #{code.ACTIVE}
		 where 1 = 1
		   and CO_TYPE = #{code.CO_TYPE}
		   and CO_NO = #{code.CO_NO} 
		</foreach>	
	</update>
	
<!-- 	<select id="getCategoryList" resultType="map"> -->
<!-- 		select SEQ -->
<!-- 				, CODE -->
<!-- 				, ACTIVE -->
<!-- 		from CODE -->
<!-- 		where CO_TYPE = 'CM' -->
<!-- 		ORDER BY SEQ -->
<!-- 	</select>	 -->
	
	<insert id="inputForm">
		insert into PRODUCT
			(PRO_NO
			, PRO_WR
			, PRO_NAME
			, PRO_PRICE
			, PRO_CONTENT
			, PRO_CATE
			, PRO_STATUS
			, PRO_TC
			, PRO_TSC
			, PRO_DATE
			)
		values (CONCAT('PR', IFNULL((SELECT MAX(CAST(replace(PRO_NO, 'PR', '') AS unsigned))+1
									 FROM PRODUCT A), 1))
			, #{MEM_ID}
			, #{PRO_NAME}
			, #{PRO_PRICE}
			, #{PRO_CONTENT}
			, #{PRO_CATE}
			, #{PRO_STATUS}
			, #{PRO_TC}
			, 'TM1'
			, DATE_FORMAT(SYSDATE(), '%Y%m%d%H%i%s'))
	</insert>
	
	<select id="getForm" resultType="map">
			select 
				CO_TYPE
				, CO_NO
				, CODE
				, CO_DETAIL
				, SEQ
				, ACTIVE
			from CODE
			where CO_TYPE = 'FO'
			and CO_NO != '7'
			ORDER BY SEQ
	</select>
	
	
	
<!-- 	===== 현아 끝 ===== -->



<!-- 	===== 무창 시작 ===== -->

	<select id="codeSelect" parameterType="java.util.List" resultType="map">
		<foreach collection="list" item="code" open="" close="" separator=";">
		select ACTIVE
		  from CODE
		 where 1 = 1
		   and CO_TYPE = #{code.CO_TYPE} 
		   and CO_NO = #{code.CO_NO}
		</foreach>		   
	</select>

	<insert id="codeInsert" parameterType="java.util.List">
		insert 
			into CODE
				(
				  CO_TYPE
				, CO_NO
				, CODE
				, HIDE
				, ACTIVE
				)
			values
		<foreach collection="list" item="code" open="" close="" separator=",">
				(
				  #{code.CO_TYPE}
				, (select cast(max(cast(CO_NO as signed)) + 1 as char)
					 from CODE
					where 1 = 1
					  and CO_TYPE = #{code.CO_TYPE})
    			, #{code.CODE}
    			, '0'
    			, '0'
				)	
		</foreach>
	</insert>

	<update id="codeUpdate" parameterType="java.util.List">
		<foreach collection="list" item="code" open="" close="" separator=";">
		update CODE
		   set CODE = #{code.CODE}
		   <if test='code.HIDE == "1"'>
		   	 , ACTIVE = '0'
		   	 , HIDE = #{code.HIDE}
		   </if>
		   <if test='code.HIDE == "0"'>
		   	 , ACTIVE = #{code.ACTIVE}
		   	 , HIDE = #{code.HIDE}
		   </if>
		 where 1 = 1
		   and CO_TYPE = #{code.CO_TYPE}
		   and CO_NO = #{code.CO_NO} 
		</foreach>	
	</update>

	<delete id="codeDelete" parameterType="java.util.List">
		delete from CODE
		 where
		<foreach collection="list" item="code" open="" close="" separator="or">
			(CO_TYPE = #{code.CO_TYPE} and CO_NO = #{code.CO_NO})		
		</foreach>
	</delete>
	
	<insert id="messageInsert" parameterType="java.util.List">
		insert 
			into MESSAGE
				(
				  CO_TYPE
				, CO_NO
				, CODE
				, HIDE
				)
			values
		<foreach collection="list" item="code" open="" close="" separator=",">
				(
				  #{code.CO_TYPE}
				, (select cast(max(cast(CO_NO as signed)) + 1 as char)
					 from CODE
					where 1 = 1
					  and CO_TYPE = #{code.CO_TYPE})
    			, #{code.CODE}
    			, '0'
				)	
		</foreach>
	</insert>

	<update id="messageUpdate" parameterType="java.util.List">
		<foreach collection="list" item="code" open="" close="" separator=";">
		update MESSAGE
		   set CODE = #{code.CODE}
		   	 , HIDE = #{code.HIDE}
		 where 1 = 1
		   and CO_TYPE = #{code.CO_TYPE}
		   and CO_NO = #{code.CO_NO} 
		</foreach>	
	</update>

	<delete id="messageDelete" parameterType="java.util.List">
		delete from MESSAGE
		 where
		<foreach collection="list" item="code" open="" close="" separator="or">
			(CO_TYPE = #{code.CO_TYPE} and CO_NO = #{code.CO_NO})		
		</foreach>
	</delete>
	
<!-- 	===== 무창 끝 ===== -->



<!-- 	===== 성엽 시작 ===== -->

	<select id="getMemberList" resultType="map">
		 select MEM_NO
			  , MEM_ID
			  , MEM_NICK
			  , MEM_NAME
			  , MEM_EMAIL
			  , MEM_DATE
			  , (select COUNT(*)
				  from REPORT
				 where RPT_USER_NO = MEM_NO) as COUNT
			  , MEM_CAT
		  from MEMBERS
		 ORDER BY MEM_NO;
	</select>
	
	<select id="getContentboardList" resultType="map">
		select PRO_NO
			 , PRO_NAME
			 , PRO_WR
			 , date_format(str_to_date(PRO_DATE, '%Y%m%d%H%i%s'), '%Y%m%d %H:%i:%s')  AS PRO_DATE
		from PRODUCT
		where PRO_TC = 'MM1'
		ORDER BY PRO_NO DESC
	</select>
	
	<select id="getBoardCategoryList" parameterType="map" resultType="map">
		select PRO_NO
			 , PRO_NAME
			 , PRO_WR
			 , date_format(str_to_date(PRO_DATE, '%Y%m%d%H%i%s'), '%Y%m%d %H:%i:%s')  AS PRO_DATE
		from PRODUCT
		where 1 = 1
		<if test="category == 'MM1'">
		  AND PRO_TC = 'MM1'
		</if>
		<if test="category == 'MM2'">
		  AND PRO_TC = 'MM2'
		</if>
		<if test="category == 'MM3'">
		  AND PRO_TC = 'MM3'
		</if>
		<if test="category == 'MM4'">
		  AND PRO_TC = 'MM4'
		</if>
		ORDER BY PRO_NO DESC
	</select>
	
	<update id="memberStop" parameterType="map">
		update MEMBERS
		   set MEM_CAT = #{newState}
		 WHERE 1 = 1  
		   and MEM_CAT = #{oldState}
		   and MEM_NO = #{memNo}
	</update>
	
	<delete id="contentDelete">
		delete from PRODUCT
		where PRO_NO = #{PRO_NO}
	</delete>
	
	<delete id="cateContentDelete">
		delete from PRODUCT
		where PRO_NO = #{PRO_NO}
	</delete>
	
	<select id="getReportList" resultType="map">
		select 
			   RPT_NO
			 , USER_NO
			 , (select MEM_ID from MEMBERS WHERE MEM_NO = RPT_USER_NO) RPT_USER_NO
			 , CODE
			 , date_format(RPT_TIME, '%Y-%m-%d %H:%I:%S') as RPT_TIME
		from REPORT
		join CODE
		  on RPT_SELECT = concat(CO_TYPE, CO_NO)
		ORDER BY RPT_NO DESC
	</select>
	
	<insert id="insertReport" parameterType="map">
		insert INTO REPORT
			 ( RPT_NO
			 , USER_NO
			 , RPT_USER_NO
			 , RPT_SELECT
			 , RPT_TIME)
		values(
			  (SELECT *
				 FROM (SELECT IFNULL(MAX(CAST(RPT_NO as unsigned)), 0) + 1
						 FROM REPORT) A)
			, #{MEM_ID}
			, #{rptUserIdx}
			, #{rptCode}
			, DATE_FORMAT(NOW(), '%Y%m%d%H%i%s'))
	</insert>
	<!-- {rptUserIdx=MEM1, rptCode=DCM1, MEM_ID=chat01} -->



<!-- 	===== 성엽 끝 ===== -->
	
	

</mapper>